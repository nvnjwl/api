SPL.controller={},SPL.controller.base=function(){var e=this,n=this;e.activeElement="",e.isAutoPlay=!1,e.allowedPreviewCheck=!0,e.previewThreshhold=15;var a=["init","ready","_adstate","error","ended","start","state","ended"];e.convertEvent={ready:"onReady",start:"onPlayStart",state:"onStateChange",_adstate:"onAdEvent",fs:"onFullScreen",onDimClick:"onDimClick",onEndScreenAutoPlay:"onEndScreenAutoPlay",onEndScreenReplay:"onEndScreenReplay",onEndScreenPlay:"onEndScreenPlay"},e.receivedEvents={manifest:!1,complete:!1,ended:!1},e.setActiveElement=function(n){e.activeElement=n},e.getActiveElement=function(){return e.activeElement},e.initUI=function(e){this.loadUI(e)},e.init=function(a){n.playerIndex=SPL.allPlayerList.length,SPL.allPlayerList.push(n),this.load(a,n),void 0===e.playerObjConfig.playerVars.sp&&""!=e.playerObjConfig.playerVars.sp||(SPL.isMobile?e.playerObjConfig.playerVars.sp="mweb":e.playerObjConfig.playerVars.sp="web")},e.loadUI=function(n){var a=n.containerID;n.eventManagerObj=new SPL.eventmanager.EventManager(n),n.eventManagerObj.on("controller",n.onPlayerEvent),n.videoElem="",n.videoID=a+"_videoTag",n.playerContainerID=a;var r=n.currentCounter,t=n.playerObjConfig.playerVars.isWatermark;e.isReplay=n.playerObjConfig.playerVars.isReplay;var o="",i="";t&&(o=n.playerObjConfig.playerVars.watermarkIcon,i=n.playerObjConfig.playerVars.watermarkUrl),1==SPL.CID[e.containerIDClient].sameContainer?n.videoElem=e.playerObjConfig.videoElem:(UTIL.createVideoView(a,r,t,o,i),n.videoElem=UTIL.createVideoTag(a,n.videoID,r),e.playerObjConfig.videoElem=n.videoElem),_elemAddClass(n.videoElem,"spl_Fc")},e.load=function(e,n){n.Player={},n.Player=new SPL.SPlayer(n,e,n.videoElem),n.Player.init()},e.onPlayerEvent=function(n,r,t,o){if("_adstate"==n)switch(r.state){case"load":case"ready":case"request":case"loaded":break;case"start":e.setActiveElement(e.adManagerObj);break;case"Q1":case"Q2":case"Q3":case"complete":case"skip":break;case"ended":case"error":e.setActiveElement(e.curPlayer)}else switch(n){case"init":e.getFeed();break;case"complete":e.deletePreview();break;case"ended":e.playerObjConfig.playerVars.controls.showEndseekbar,document.removeEventListener("keyup",e.keyupListener)}-1!=a.indexOf(n)&&e.sendToClient(n,r,t);var i=Array.prototype.slice.call(arguments);switch(i.push(e.playerIndex),"undefined"!=playerIndex&&void 0!=playerIndex||(playerIndex=""),function(n){setTimeout(function(n){try{e.playerObjConfig.onplayerEvent&&e.playerObjConfig.onplayerEvent.apply("",n)}catch(e){}},0,n)}(i),n){case"init":break;case"ready":e.createKeyboardEvents();break;case"initload":e.playerInitCallback();break;case"_adstate":case"manifest":break;case"volume":SPL.setLocalSettings({volume:r.volume});break;case"position":if(null!=e.EndScreenPreview_Obj&&void 0!=e.EndScreenPreview_Obj&&1==e.isPreViewVisible){var l=r.position,s=r.duration,c=e.previewThreshhold;e.EndScreenPreview_Obj.setWidth(l,s,c)}e.allowedPreviewCheck&&!SPL.isMobile&&(e.allowedPreviewCheck=!1,e.checkPreview(r),setTimeout(function(){e.allowedPreviewCheck=!0},1e3));break;case"state":break;case"start":var d=e.playerObjConfig.playerVars.playlist;if("true"==d||1==d){""!=(y=e.getNextVideoId(e.videoId))&&void 0!=y&&"undefined"!=y&&null!=y?e.setNextVideo(y):e.playerObjConfig.playerVars.nextVideoID="";var v=e.getPrevVideoId(e.videoId);""!=v&&void 0!=v&&"undefined"!=v&&null!=v?e.setPrevVideo(v):e.playerObjConfig.playerVars.prevVideoID=""}else{var y=e.playerObjConfig.playerVars.nextVideoID;""!=y&&void 0!=y&&"undefined"!=y&&null!=y?e.setNextVideo(y):(e.playerObjConfig.playerVars.controls.autoplayDefault=!1,e.controlsBaseObj.isAutoPlayNext=!1)}}},e.sendToClient=function(a,r,t){var o=a,i=e.curPlayer.getData(),l=[];l[0]=r,l[1]=i;var s=e.convertEvent[a];switch(void 0!=s&&(a=s),a){case"onReady":n.playerObjConfig.events.onReady(o,l);break;case"onPlayStart":n.playerObjConfig.events.onPlayStart(o,l,e);break;case"start":n.playerObjConfig.events.onPlayStart(o,l,e),e.overlayContainer();var c=n.playerObjConfig.playerVars.isOverlayAds;if(1==c||"true"==c){var d=e.overlayContainer,v=e.showOverlayAds,y=e.hideOverlayAds;n.playerObjConfig.events.onOverlayAds(v,y,d)}break;case"ended":n.playerObjConfig.events.onEnd(o,l,e);break;case"complete":break;case"onStateChange":e.curPlayer;n.playerObjConfig.events.onStateChange(o,l);break;case"onAdEvent":e.deletePreview(),n.playerObjConfig.events.onAdEvent(o,l);break;case"onFullScreen":n.playerObjConfig.events.onFullScreen(o,l);break;case"onDimClick":n.playerObjConfig.events.onDimClick(o,l);break;case"onEndScreenAutoPlay":n.playerObjConfig.events.onEndScreenAutoPlay(o,l);break;case"onEndScreenReplay":n.playerObjConfig.events.onEndScreenReplay(o,l);break;case"onEndScreenPlay":n.playerObjConfig.events.onEndScreenPlay(o,l);break;case"onEndScreenNextClick":n.playerObjConfig.events.onEndScreenNextClick(o,l);break;case"onEndScreenAutoPlay":n.playerObjConfig.events.onEndScreenAutoPlay(o,l)}},e.playerInitCallback=function(){S.player=e,e.onLoad&&"function"==typeof e.onLoad&&e.onLoad(e)},e.destroy=function(a){function r(){n.eventManagerObj=null,document.removeEventListener("keyup",e.keyupListener),a&&a()}n.Player.destroy(function(){n.Player=null,n.eventManagerObj.destroy(r)}),n.eventManagerObj.unsubscribe("controller")},e.keyupListener=function(n){e.controlsBaseObj&&e.controlsBaseObj.cbar&&e.controlsBaseObj.cbar.show(),e.controlsBaseObj&&e.controlsBaseObj.hideQualityMenu&&e.controlsBaseObj.hideQualityMenu();var a=n.keyCode;switch(a){case key.space:e.togglePlay();break;case key.left:e.seek(-5);break;case key.right:e.seek(5);break;case key.up:case key.volumeUp:e.volume(2);break;case key.down:case key.volumeDown:e.volume(-2);break;default:e.test(a)}},e.createKeyboardEvents=function(){_el(e.playerObjConfig.containerID);document.addEventListener("keyup",e.keyupListener),document.addEventListener("keydown",function(e){})},e.togglePlay=function(){void 0!=e.getActiveElement&&(e.getActiveElement().isPaused?e.getActiveElement().play():e.getActiveElement().pause())},e.seek=function(n){e.Player.seek(n)},e.play=function(){e.Player.play()},e.pause=function(){e.Player.pause()},e.setVolume=function(n){n>100&&(n=100),n<1&&(n=0),e.controlsBaseObj.volume.show(),e.Player.setVolume(n)},e.volume=function(n){var a=e.getVolume();e.setVolume(a+n)},e.getVolume=function(){return e.Player.getVolume()},e.hibernate=function(n){"function"==typeof e.Player.hibernate&&e.Player.hibernate(function(e){"function"==typeof n&&n(e=e||"SUCCESS")})},e.test=function(n){switch(n){case 82:e.Player.test()}},e.isPreViewVisible=!1,e.EndScreenPreview_Obj=null,e.createNextHover=function(){if(!SPL.isMobile&&0!=e.playerObjConfig.playerVars.nextButton){var n=e.playerObjConfig.playerVars.nextVideoID;e.EndScreenPreview_Left=new EndScreenPreview(n,e,e.NextVideoData);var a=e.EndScreenPreview_Left.init("left");e.controlsBaseObj&&(e.controlsBaseObj.nextScreenleft=a)}},e.createPrevHover=function(){if(!SPL.isMobile){var n=e.prevVideoID;e.EndScreenPreview_Left=new EndScreenPreview(n,e,e.PrevVideoData);var a=e.EndScreenPreview_Left.init("leftPrev");e.controlsBaseObj&&(e.controlsBaseObj.prevScreenleft=a)}},e.deletePreview=function(){null!=e.EndScreenPreview_Obj&&void 0!=e.EndScreenPreview_Obj&&(e.isPreViewVisible=!1,e.EndScreenPreview_Obj.delete("right"),e.EndScreenPreview_Obj=null,e.controlsBaseObj&&(e.controlsBaseObj.endScreenVisible=!1))},e.checkPreview=function(n){if(e.controlsBaseObj.isAutoPlayNext){var a=n.position,r=n.duration-a,t=e.previewThreshhold;r<t?0==e.isPreViewVisible&&(e.isPreViewVisible=!0,e.EndScreenPreview_Obj=new EndScreenPreview("hls",e,e.NextVideoData),e.EndScreenPreview_Obj.init("right"),e.controlsBaseObj&&(e.controlsBaseObj.endScreenVisible=!0)):r>t&&e.isPreViewVisible&&null!=e.EndScreenPreview_Obj&&void 0!=e.EndScreenPreview_Obj&&(e.isPreViewVisible=!1,e.EndScreenPreview_Obj.delete("right"),e.EndScreenPreview_Obj=null,e.controlsBaseObj&&(e.controlsBaseObj.endScreenVisible=!1))}},e.setNextVideo=function(n){e.playerObjConfig.playerVars.nextVideoID=n,e.getNextData(n,function(n){e.NextVideoData=n,e.createNextHover(),e.controlsBaseObj&&e.controlsBaseObj.showNextButton&&e.controlsBaseObj.showNextButton()},function(e){})},e.setPrevVideo=function(n){e.playerObjConfig.playerVars.prevVideoID=n,e.getPrevData(n,function(n){e.PrevVideoData=n,e.createPrevHover(),e.controlsBaseObj&&e.controlsBaseObj.showPrevButton&&e.controlsBaseObj.showPrevButton()},function(e){})},e.getPrevData=function(e,n,a){SPL.Api.feed(e,function(e){if(void 0===e){r="FAILURE0";a&&a(r)}else if(void 0!==e.error)if("404"==e.error){r="FAILURE1";a&&a(r)}else{r="FAILURE2";a&&a(r)}else if("FAILURE"==e){var r="FAILURE3";a&&a(r)}else n&&n(e)})},e.getFeed=function(){if(e.feedData=e.playerObjConfig.feedData,void 0==e.feedData||null==e.feedData||""==e.feedData){e.playerObjConfig.playerVars.playlist;var n=e.playerObjConfig.playerVars.nextVideoUrl;""!=n&&void 0!=n&&loadJs(n,function(){})}},window.cached=function(n){S.feedData=n,S.playerObjConfig.feedData=n,S.isFeedAvailaible=!0,e.feedData=n,e.playerObjConfig.feedData=n,e.isFeedAvailaible=!0;var a=e.getNextVideoId(e.videoId);""!=a&&void 0!=a&&"undefined"!=a&&null!=a?e.setNextVideo(a):e.playerObjConfig.playerVars.nextVideoID=""},e.getNextData=function(e,n,a){SPL.Api.feed(e,function(e){if(void 0===e){r="FAILURE0";a&&a(r)}else if(void 0!==e.error)if("404"==e.error){r="FAILURE1";a&&a(r)}else{r="FAILURE2";a&&a(r)}else if("FAILURE"==e){var r="FAILURE3";a&&a(r)}else n&&n(e)})},e.getNextVideoId=function(n){if(void 0==e.feedData||""==e.feedData||null==e.feedData)return"";var a=e.feedData,r=a.length,t=0,o="";t=a.length-1;for(var i=0;i<t;i++)a[i]._id==n&&(o=a[(i+1)%r].kalturaid);return o},e.getPrevVideoId=function(n){if(void 0==e.feedData||""==e.feedData||null==e.feedData)return"";var a=e.feedData,r=(a.length,0),t="";r=a.length;for(var o=0;o<r;o++)if(a[o]._id==n){var i=o-1;if(i<0)break;t=a[i]._id}return t},e.showOverlayAds=function(){_elemRemoveClass(e.overlayContainer,"spl_H")},e.hideOverlayAds=function(){_elemAddClass(e.overlayContainer,"spl_H")},e.overlayContainer=function(){var n=e.controlsBaseObj.actiondiv,a=UTIL.createDiv("overlayContainer1","spl_banner spl_A spl_Fb spl_aBR",n);e.overlayContainer=a}};