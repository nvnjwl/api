SPL.plugins.adManager=function(e,t,a,n,i){function o(e,t,a,n,i){var o=document.createElement("script"),r=[];t={adData:{ids:t,duration:a,url:i},dispatchEvent:function(e){this.sendEvent?(r&&(r.push(e),e=r,r=!1),this.sendEvent(e)):r.push(e)}},a="_moatApi"+Math.floor(1e8*Math.random());var s,d;try{s=e.ownerDocument,d=s.defaultView||s.parentWindow}catch(e){s=document,d=window}return d[a]=t,o.type="text/javascript",e&&e.insertBefore(o,e.childNodes[0]||null),o.src="https://z.moatads.com/"+n+"/moatvideo.js#"+a,t}function r(e){try{m&&(_le("Sending moat data..."+e.type),p.dispatchEvent(e))}catch(e){}}function s(e,t){if(m)if(void 0!==e&&void 0!==t){var a={},n=e.getTitle().split("|");a.level1=n.length<=1?"":n[n.length-1],a.level2=e.getAdId(),a.level3=e.getAdId(),a.level4=e.getCreativeId(),a.slicer1="",a.slicer2="",p=o(t,a,e.getDuration(),"timesofindiaslikejsvideo152964269350",window.parent.document.location.href)}else _le("MOAT was found but due to some issue this is disabled for now.");else _le("MOAT is not enabled.")}function d(e){u.libraryLoaded&&u.initreceived&&l(e)}function l(a){if(u.timeCode=a,u.prepared||null!==_){if(void 0!==e.ads.campaign){c.hide();for(var n=-1,i=0,o=-10;i<e.ads.timecode.length;i++)if((-1==(o=e.ads.timecode[i])&&-1==a||o>=0&&o<=a)&&-1===window.adsPlayed.indexOf(o)){n=i;break}if(-1!==n&&-1===window.adsPlayed.indexOf(_mr(a))){u._.isPostRoll=-1===a;r=e.ads.campaign[n];u.currentAdlength=r.length,u._.current=r[0],u.requestAds(u._.current.url)}else{u._.isPostRoll=-1===a,window.adsPlayed[window.adsPlayed.length]=o;var r=e.ads.campaign[n];u._.current=r[0],void 0!==t.adconf&&(u._.current.url=replacePairs(u._.current.url,t.adconf)),u.requestAds(u._.current.url)}}}else _=a}SPL.conf;var u=this;u.pluginName="adManager",u.name="adManager",u.containerID=n,u.player=a,u.conf=t.playerVars,u.id="adManager",u.eventOccured={loaded:!1,start:!0},u.libraryLoaded=!1,u.initreceived=!1;var c=a.loader;u._={pl:null,isBusy:!1,current:null,isPostRoll:!1,isPostRoll:!1,tmr:null},u._ad={},u.prepared=!1,window.adsPlayed=window.adsPlayed||[],u.rtad=0,u.isQ0=!0,this.adsPlayed=[],u._.data={adtype:"pre",duration:0,adId:0,position:0,event:0,state:"error",rtad:u.rtad},u.adEventDispatchedList=[],u.adSingleEventList=["init","ready","initload","manifest"],u.adRetryDefault=1,u.adRetryCount=u.adRetryDefault,u.canErrorSend=!0,u.uniqueAdID,u.isDispatchedAgain=function(e){return!u.isOneTimeEvent()||-1==u.eventDispatchedList.indexOf(e)},u.isOneTimeEvent=function(e){return-1!=u.singleEventList.indexOf(e)},u.createADControls=function(e){var t=UTIL.createDiv("","spl_A spl_FS spl_z3 spl_H",e);t.setAttribute("style","height: 100%;width: 100%"),u._ad.adContainer=t,u._ad.imaVideo=i.videoElem;var a=UTIL.createDiv("","spl_aContainer spl_A spl_FS",t);u._ad.aContainer=a;var n=UTIL.createDiv("","spl_A spl_bl _spl_bottom",t);u.buttons=n;var o=UTIL.createDiv("","spl_ch spl_l spl_fl spl_z1 spl_ico spl_shd",n,"");o.setAttribute("data-title","Pause");var r=UTIL.createDiv("","spl_ch spl_l spl_fl spl_z1 spl_ico spl_shd",n,"");r.setAttribute("data-title","Mute"),u._ad.Volume=r,u._ad.PlayButton=o;var s=UTIL.createDiv("","spl_A spl_Fb _spl_seekbar",t);u.seekbar=s,_els(s,"width","0%"),s.setAttribute("style","border: 2px solid yellow;"),u._ad.seekbar=s},u.onPlayerEvent=function(e,t){var a={init:function(){u.initreceived=!0,u.player=this,SPL.isMobile||(u._.isPreRoll=!0,d(0))},ready:function(){},start:function(){c.hide(),u._.isPreRoll},manifest:function(){},position:function(e){_mf(e.position),_mf(u.tc),u.tc=_mr(e.position)},complete:function(){l(-1)}};a[e]&&a[e].apply(this,[t])};var p,m=!1,_=null,y=null;u.onAdEvents=function(e){if(void 0!==u.player&&void 0!==e&&null!=e)if(void 0!==(y=e.getAd()))if(null!=y){if(u.adsState=e.type,"loaded"===e.type){var t=y.getTitle();-1!==(t=void 0===t?"":t).indexOf("MOAT|")?(m=!0,s(y,_el("html5"))):m=!1,y.isLinear()||(_elemAddClass(u.buttons,"spl_H"),_elemAddClass(u.seekbar,"spl_H"))}else m&&(_le("MOAT is enabled...sending data now."),"start"===e.type?r({type:"AdVideoStart",adVolume:u.AM.getVolume()}):"firstquartile"===e.type?r({type:"AdVideoFirstQuartile",adVolume:u.AM.getVolume()}):"midpoint"===e.type?r({type:"AdVideoMidpoint",adVolume:u.AM.getVolume()}):"thirdquartile"===e.type?r({type:"AdVideoThirdQuartile",adVolume:u.AM.getVolume()}):"complete"===e.type?r({type:"AdVideoComplete",adVolume:u.AM.getVolume()}):"playing"===e.type?r({type:"AdPlaying",adVolume:u.AM.getVolume()}):"paused"===e.type?r({type:"AdPaused",adVolume:u.AM.getVolume()}):"volumeChange"===e.type?r({type:"AdVolumeChange",adVolume:u.AM.getVolume()}):"skip"===e.type&&r({type:"AdStopped",adVolume:u.AM.getVolume()}));var a={click:[9,"click"],complete:[7,"complete"],firstquartile:[4,"Q1"],loaded:[0,"loaded"],midpoint:[5,"Q2"],start:[1,"start"],thirdquartile:[6,"Q3"],skip:[8,"skip"],pause:[10,"PAUSED"],resume:[11,"RESUME"]},n=void 0===y.getDuration()?0:y.getDuration();u._.data={adtype:u.player&&!1!=!!u.player.position&&!0!==u._.isPreRoll&&!0!=!!u.player.isLive()?_mf(u.player.position)===_mf(u.player.duration)?"post":"mid":"pre",duration:n,adId:void 0===y.getAdId()?"":y.getAdId(),campaignId:u._.current.id,source:u._.source,muted:u.player.isMute,paused:!(!a[[e.type]]||10!==a[[e.type]][0]),position:_f(n)-_f(u.AM.getRemainingTime()),event:a[[e.type]]?a[[e.type]][0]:null,isQueueable:!0,state:a[[e.type]]?a[[e.type]][1]:null,rtad:u.rtad};var i={allAdsCompleted:function(){_ld("allAdsCompleted:::")},start:function(){c.hide(),clearTimeout(u._.tmr),v.onstart(),u.eventOccured.start=!0,u.hideControls(),u.isQ0=!0},resume:function(){v.play()},pause:function(){v.pause()}};i[e.type]&&i[e.type].call(this),u.eventOccured.loaded=!0,u._.data.state&&u.player&&u.player.onAdevent(_JSF(u._.data)),"complete"!==u._.data.state&&"skip"!==u._.data.state||(clearInterval(v.tmr),setTimeout(v.onend,30))}else u.onAdError(null);else u.onAdError(null)},u.hideControls=function(){"Mobile Safari"==SPL.browserName&&(_elemAddClass(u.contentPlayer,"spl_z5"),_elemAddClass(u.buttons,"spl_H"),_elemAddClass(u.seekbar,"spl_H"))},u.requestAds=function(t){u.canErrorSend=!0,e.adsTimeout=_mr(e.adsTimeout)>=4e3?e.adsTimeout:1e4,null!=u._.tmr&&(clearTimeout(u._.tmr),u._.tmr=null),u._.tmr=setTimeout(u.onTimeout,e.adsTimeout);var a=_gup("iu",t);a=extractIU(a),u._.data={adtype:!0===u._.isPreRoll?"pre":-1==_mr(u.tc)||!0===u._.isPostRoll?"post":"mid",duration:0,adId:0,campaignId:u._.current.id,source:u._.source,muted:u.player&&u.player.isMute,paused:null,position:0,event:0,iudata:a,isQueueable:!0,state:"request",rtad:u.rtad},u.player.timeadrequest=new Date,u._.isBusy=!0,c.show(),u.aR=new google.ima.AdsRequest,void 0===u.conf.pid&&(u.conf.pid=""),"null"===u.conf.pid&&(u.conf.pid=""),void 0===u.conf.sg&&(u.conf.sg=""),"null"===u.conf.sg&&(u.conf.sg="");var n=""!=u.conf.sg&&-1==u.conf.sg.indexOf("sg=")?"&sg="+u.conf.sg:"&"+u.conf.sg;n=encodeURIComponent(n);var i=""==u.conf.pagesection?"_":u.conf.pagesection;i=getSF(i);var o="pid%3D"+(""==u.conf.pid?"_":u.conf.pid)+"%26section%3D"+i,r="_";try{void 0!==e&&void 0!==e.vendor&&(r=e.vendor)}catch(e){}o+="%26vendor%3D"+r,o+=n;var s=t.match(/(cust_params=[^&]*)/gi);null==s?t+="&cust_params="+o:(t=t.replace(s,""),t+="&"+(s+="%26"+o));u.aR.adTagUrl=t,u.aR.linearAdSlotWidth="100%",u.aR.linearAdSlotHeight="100%",location.hash="!/tc/"+_mr(_f(this.tc)),u.player&&u.player.onAdevent(_JSF(u._.data)),u.adsLoader.requestAds(u.aR)},u.onTimeout=function(){u._.isBusy=!1,v.onend()},u.isUserActionCaptured=!1,u.onUserAction=function(e){if(!u.isUserActionCaptured){u.isUserActionCaptured=!0,u.initialUserAction(e);try{SPL.UA.getOS().name}catch(e){}}},u.oninit=function(){u.isReady=!0,u.prepare()},this.onPrepared=function(){u.libraryLoaded=!0,u.prepared=!0,u._.data.state="ready",u.player&&u.player.onAdevent(_JSF(u._.data)),null===_||SPL.isMobile?d(0):l(_),v.init()},this.prepare=function(){this.Container=_el(u._ad.aContainer),this.contentPlayer=_el(u._ad.imaVideo),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE),google.ima.settings.setVpaidAllowed(google.ima.ImaSdkSettings.VpaidMode.ENABLE),google.ima.settings.setCompanionBackfill(google.ima.ImaSdkSettings.CompanionBackfillMode.ALWAYS),this.adDisplayContainer=new google.ima.AdDisplayContainer(u.Container,u.contentPlayer),this.adsLoader=new google.ima.AdsLoader(u.adDisplayContainer),this.adsLoader.addEventListener("adsManagerLoaded",u.onAdsManagerLoaded,!1,u),this.adsLoader.addEventListener("adError",u.onAdError,!1,u),this.onPrepared()},u.onAdsManagerLoaded=function(e){var t=new google.ima.AdsRenderingSettings;t.restoreCustomPlaybackStateOnAdBreakComplete=!1,t.bitrate=600,t.enablePreloading=!0,t.useStyledLinearAds=!0,t.useStyledNonLinearAds=!0,t.autoAlign=!0,u.AM=e.getAdsManager(u.contentPlayer,t),u.processAdsManager(u.AM)},u.processAdsManager=function(){u.AM.isCustomClickTrackingUsed()&&(u.customClickDiv_.style.display="table");try{0!=u.conf.settings.volume&&u.AM.setVolume(u.conf.settings.volume/100)}catch(e){}u.AM.addEventListener("contentPauseRequested",u.onContentPauseRequested,!1,u),u.AM.addEventListener("contentResumeRequested",u.onContentResumeRequested,!1,u),u.AM.addEventListener("adError",u.onAdError,!1,u);var e=["allAdsCompleted","click","complete","firstquartile","loaded","midpoint","pause","start","thirdquartile","skip","volumeChange","resume"];for(var t in e)u.AM.addEventListener(e[t],u.onAdEvents,!1,u);u.startAd()},u.startAd=function(){u.AM.init("100%","100%",google.ima.ViewMode.NORMAL);try{u.AM.start()}catch(e){}},u.AdErrorTimer=null,u.onAdError=function(e){function t(){return!u.eventOccured.loaded&&!u.eventOccured.start}function a(e,a){var n=e.adRetryCount;if(n>0&&n<e.currentAdlength&&t())e.adFailover();else{c.hide(),clearTimeout(e._.tmr),clearInterval(this.tmr),this.AM&&this.AM.destroy();_mr(e.tc)<=1||!0===e._.isPreRoll?"pre":-1==_mr(e.tc)||!0===e._.isPostRoll?"post":"mid",e._.data={adtype:!0===e._.isPreRoll?"pre":-1==_mr(e.tc)||!0===e._.isPostRoll?"post":"mid",duration:0,adId:0,campaignId:e._.current.id,source:e._.source,muted:e.player&&e.player.isMute,paused:null,position:0,event:0,state:"error",isQueueable:!0,errorcode:a.getError().h,rtad:e.rtad},!0===e._.isPreRoll&&(e._.isPreRoll=!1);var i={module:"admanager",message:e._.data.errorcode,code:"9000",type:"critical"};SPL.error.log(i),e.player&&e.player&&e.player.onAdevent(_JSF(e._.data)),setTimeout(v.onend,100)}}clearTimeout(u.AdErrorTimer),u.AdErrorTimer=null,u.AdErrorTimer=setTimeout(function(e){a(u,e)},500,e)};var v={vol:.1,tmr:null,muted:!1,paused:!1,progress:function(){var e=u.AM.getCurrentAd().getDuration(),t=e-_f(u.AM.getRemainingTime());if(void 0!=e){t>3&&u.isQ0&&u.on3seconds();var a=_els(u._ad.seekbar,"width");if(NaN!=t&&void 0!=t&&NaN!=e&&void 0!=e&&0!=a){_els(u._ad.seekbar,"width",t/e*100+"%");var n=t/e*100;setTimeout(function(e){},1e4,n)}else _els(u._ad.seekbar,"width","0%")}},onstart:function(){u.player&&u.player.isMute?v.volume(0):u.player&&!u.player.isMute&&0!==u.player.volume()&&v.volume(u.player.volume()/100),c.hide(),_elemRemoveClass(u._ad.adContainer,"spl_H");u.conf.controls.adplaypause=!1,void 0!==u.conf.controls.adplaypause&&!1===u.conf.controls.adplaypause&&_elemRemoveClass(u._ad.PlayButton,"spl_H"),v.tmr=setInterval(v.progress,125)},onend:function(){_elemAddClass(u._ad.adContainer,"spl_H"),u.onend(),clearInterval(v.tmr)},init:function(e){_elemListenersAttach(u._ad.PlayButton,"click",v.pp),_elemListenersAttach(u._ad.Volume,"click",v.volumeToggle)},mute:function(){_elsa(u._ad.Volume,"data-title","Unmute"),SPL.setLocalSettings({mute:!0}),u.AM.setVolume(0),v.muted=!0,u.player.mute()},unmute:function(){_elsa(u._ad.Volume,"data-title","Mute"),u.AM.setVolume(u.player.volume()/100),_elemRemoveClass(u._ad.Volume,"fcr"),v.muted=!1,u.player.unmute(),SPL.setLocalSettings({mute:!1})},volumeToggle:function(e){var t=_elsa(u._ad.Volume,"data-title");"Mute"==t?v.mute():"Unmute"==t&&v.unmute()},volume:function(e){if(0==e)v.mute();else{var t=!1;try{u.conf&&u.conf.offline.volume&&(t=SPL.localSettings.mute),void 0==t&&(t=!1)}catch(e){t=!1}var a=t,n=u.player.volume();u.AM&&1==a?v.mute():u.AM&&n>0&&0==a&&v.unmute()}},pause:function(){v.paused=!0;var e=u._.data;u.AM.pause(),u._ad.PlayButton.setAttribute("data-title","Play"),u.sendEvent("pause","VERBOSE",e)},play:function(){v.paused=!1;var e=u._.data;u.AM.resume(),u._ad.PlayButton.setAttribute("data-title","Pause"),u.sendEvent("play","VERBOSE",e)},pp:function(){var e=_elsa(u._ad.PlayButton,"data-title");"Play"==e?v.play():"Pause"==e&&v.pause()},updatePP:function(){}};u.bootstrap=function(){u.createADControls(n);try{!window.google&&this.load()}catch(e){}try{window.google&&google.ima&&this.oninit()}catch(e){}},this.destroy=function(e){void 0!=this.AM&&null!=this.AM&&this.AM.destroy(),i.eventManagerObj.unsubscribe("adManager"),e()},u.sendEvent=function(e,t,a){i.eventManagerObj.dispatchEvent(e,t,a)},u.play=function(){v.play()},u.pause=function(){v.pause()},u.isPlaying=function(){return!v.paused},u.isPaused=function(){return v.paused},u.curIndexPre=0,u.curIndexPost=0,u.curIndexMid=0,u.adFailover=function(){function t(t){u.rtad++,e.adsTimeout=_mr(e.adsTimeout)>=8e3?e.adsTimeout:8e3,null!=u._.tmr&&(clearTimeout(u._.tmr),u._.tmr=null),u._.tmr=setTimeout(u.onTimeout,e.adsTimeout),u._.data={adtype:_mr(u.tc)<1||!0===u._.isPreRoll?"pre":-1==_mr(u.tc)?"post":"mid",duration:0,adId:0,campaignId:u._.current.id,muted:u.player&&u.player.isMute,paused:null,position:0,event:0,state:"request",rtad:u.rtad},u.player&&u.player.onAdevent(_JSF(u._.data)),u._.isBusy=!0,c.show(),null!=u.aR&&void 0!=u.aR||(u.aR=new google.ima.AdsRequest),u.aR.adTagUrl=u._.current.url,u.aR.linearAdSlotWidth="100%",u.aR.linearAdSlotHeight="100%",location.hash="!/tc/"+_mr(_f(this.tc)),u.adsLoader.requestAds(u.aR),u.adRetryCount--}function a(e){c.hide(),clearTimeout(u._.tmr),clearInterval(this.tmr);var t;t=_mr(u.tc)<=1||!0===u._.isPreRoll?"pre":-1==_mr(u.tc)||!0===u._.isPostRoll?"post":"mid",u._.data={adtype:t,duration:0,adId:0,campaignId:u._.current.id,muted:u.player&&u.player.isMute,paused:null,position:0,event:0,state:"error",errorcode:adErrorEvent.g.h+"||"+adErrorEvent.g.l+"||"+adErrorEvent.g.o,rtad:u.rtad},!0===u._.isPreRoll&&(u._.isPreRoll=!1),u.player&&u.player.onAdevent(_JSF(u._.data)),setTimeout(v.onend,10)}var n,i=u.timeCode;switch(u._.isPostRoll=-1===i,-1==i?"post":0==i?"pre":"mid"){case"pre":n=e.ads.campaign[0],u.curIndexPre++,n.length>u.curIndexPre?(u._.current=n[u.curIndexPre],t()):a();break;case"post":n=e.ads.campaign[-1],u.curIndexPost++,n.length>u.curIndexPost?(u._.current=n[u.curIndexPost],t()):a();break;case"mid":n=e.ads.campaign[1500],u.curIndexMid++,n.length>u.curIndexMid?(u._.current=n[u.curIndexMid],t()):a()}}},SPL.plugins.adManager.prototype={onContentPauseRequested:function(){this.player&&this.player.pause()},onContentResumeRequested:function(){!this._.isPostRoll&&this.player&&setTimeout(this.player.play,100)},onend:function(){var e=this;e.rtad=0,_elemRemoveClass(e.contentPlayer,"spl_z5"),e.adRetryCount=e.adRetryDefault,this._.isBusy=!1,this.AM&&this.AM.destroy(),!0===this._.isPreRoll&&(this._.isPreRoll=!1),clearTimeout(this._.tmr),clearInterval(this.tmr),this._.isBusy=!1,this._.data.state="ended",this.player&&this.player.onAdevent(_JSF(e._.data)),this._.isPostRoll&&this.player&&this.player._.dispatch("ended")},on3seconds:function(){var e=this,t={position:3,state:"Q0",rtad:e.rtad};this.player&&this.player.onAdevent(_JSF(t)),e.isQ0=!1},load:function(){this._.data.state="load",this.player&&this.player.onAdevent(_JSF(this._.data)),loadJs(SPL.conf.imaSDKUrl,this.oninit)},initialUserAction:function(){this.adDisplayContainer&&this.adDisplayContainer.initialize(),this.contentPlayer&&this.contentPlayer.load()},volume:function(e){},setVolume:function(){},toggleVolume:function(){},mute:function(){},unmute:function(){},isMute:function(){return!1}};