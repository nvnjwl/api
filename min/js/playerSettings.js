SPL.SPlayerSettings=function(currentPlayerObj,videoData,videoElem){console.log("settings ::");var t=this;var SPlayer;var Player;retryAfterAd=t.retryAfterAd;var retryCount={hls:1,dash:1,mp4:1}
playerIndex=t.playerIndex;var retryCountEachPlayer=0;var retryCountHLSPlayer=0;var retryCountDASHPlayer=0;var retryCountMP4Player=0;var curPlaybackHLS=2;var curPlaybackDASH=2;var curPlaybackMP4=2;var localInterval=null;t.reinitConf=function(){console.log("reinitconf called ",currentPlayerObj.curPlayer.position);SPlayer=currentPlayerObj.Player;Player=currentPlayerObj.curPlayer;var reinitConfig={preserveAdEvent:true,preserveVideoEvent:true,preservePosition:true,preservePlayer:true};t.reinit(reinitConfig);}
t.reinit=function(config){console.log("reinit called");var position=0;if(config.preservePosition){console.log("dev31 SPLAYER :: ",SPlayer);console.log("dev31 CURPLAYER :: ",Player);console.log("dev31 CURPLAYEROBJ :: ",currentPlayerObj);position=Player.position;console.log("dev31 POSITION :: "+position);}if(!config.preserveVideoEvent){console.log("dev31 preserveVideoEvent :: "+config.preserveVideoEvent);}if(!config.preserveAdEvent){console.log("dev31 preserveAdEvent :: "+config.preserveAdEvent);}if((position==0||t.playerName=="dash"||t.playerName=="mp4"||Player.isLive())&&config.preservePlayer){console.log("dev31 loadSourceAgain");t.loadSourceAgain(position);}else{console.log("dev31 load");currentPlayerObj.getActiveElement().play();}};t.loadSourceAgain=function(position){console.log("dev31 loadSourceAgain with :: "+t.source.url);Player.destroy(function(){SPlayer.reset();console.log("dev31 2 loadSourceAgain with :: "+t.source.url);t.reinitPlayer(position);});};t.hibernate=function(){console.log("hibernate called");};t.updateRetryCount=function(){console.log('dev21 Updating Retry Count Now for updated data :: ',t.videoDataUpdate);var hlsUrlCount=getObjLen(t.videoDataUpdate.hls);hlsUrlCount=hlsUrlCount/2;console.log('dev21 :: hlsUrlCount :: '+hlsUrlCount);var dashUrlCount=getObjLen(t.videoDataUpdate.dash);dashUrlCount=dashUrlCount/2;console.log('dev21 :: dashUrlCount :: '+dashUrlCount);var mp4UrlCount=getObjLen(t.videoDataUpdate.mp4);mp4UrlCount=mp4UrlCount/2;console.log('dev21 :: mp4UrlCount :: '+mp4UrlCount);retryCount.hls=hlsUrlCount;retryCount.dash=dashUrlCount;retryCount.mp4=mp4UrlCount;console.log('dev21 afterupdateRetryCount:: ',retryCount);function getObjLen(Obj){var counter=0;for(prop in Obj){if(Obj.hasOwnProperty(prop))counter++;}return counter;}}
t.retryAfterError=function(){var currentSelectedPlayer=currentPlayerObj.activeElement.name;console.log('dev12 admanager currentSelectedPlayer',currentSelectedPlayer);if(currentSelectedPlayer=='adManager'){console.log('dev12 admanager is Selected so retry after ad',currentPlayerObj.activeElement);retryAfterAd=true;}else{console.log('dev12 admanager is not Selected so retry now',currentPlayerObj.activeElement);retryAfterAd=true;if(t.hasAd()){retryAfterAd=true;}else{console.log("dev31 set t=",t);console.log("dev31 set this=",this);t.retryNextUrl();}}}
function isAvailaibleNext(curPlayerType){if(curPlayerType==undefined)curPlayerType="mp4";var returnValue=false;switch(curPlayerType){case"hls":if(retryCount.dash>0||retryCount.mp4>0){returnValue=true;}break;case"dash":if(retryCount.mp4>0){returnValue=true;}break;case"mp4":returnValue=false;break;default:returnValue=false;break;}return returnValue;}t.retryNextUrl=function(){console.log('in retryNextUrl before  dev21 t.sourceList :: ',t.sourceList);console.log('in retryNextUrl before dev21 t.source :: ',t.source);console.log('dev11 retryNextUrl now After Ad with playerName :: '+t.playerName);console.log('dev21 retryCount[t.playerName] was :: '+retryCount[t.playerName]+" for t.playerName:: "+t.playerName);clearInterval(localInterval);var curPlayerName=t.playerName;console.log('dev21 :: retryNextUrl came for curPlayerName :: '+curPlayerName);switch(curPlayerName){case"hls":console.log('dev21 curPlaybackHLS was :: '+curPlaybackHLS+"and retryCount[t.playerName] was ::"+retryCount[t.playerName]);if(curPlaybackHLS<=retryCount[t.playerName]){retryAfterAd=false;console.log('dev21 case hls before retryCount[t.playerName] :: '+retryCount[t.playerName]);t.source.url=t.source.urlList[2*curPlaybackHLS-2];console.log('dev21 after url update t.source.url :: ',t.source.url+" for curPlaybackHLS::"+curPlaybackHLS);curPlaybackHLS++;t.loadHls();console.log('dev21 case hls after retryCount[t.playerName] :: '+retryCount[t.playerName]);}else{console.log('dev11 else retryCount[t.playerName] was ::'+retryCount[t.playerName]+" Try next player now");retryNextPlayer(curPlayerName);}break;case"dash":if(curPlaybackDASH<=retryCount[t.playerName]){retryAfterAd=false;console.log('dev21 case dash before retryCount[t.playerName] :: '+retryCount[t.playerName]);t.source.url=t.source.urlList[2*curPlaybackDASH-2];console.log('dev21 after url update t.source.url :: ',t.source.url+"for curPlaybackDASH::"+curPlaybackHLS);curPlaybackDASH++;t.loadDash();console.log('dev21 case hls after retryCount[t.playerName] :: '+retryCount[t.playerName]);}else{console.log('dev11 else retryCount[t.playerName] was ::'+retryCount[t.playerName]+" Try next player now");retryNextPlayer(curPlayerName);}break;case"mp4":if(curPlaybackMP4<=retryCount[t.playerName]){console.log("dev22 :: case MP4 if curPlaybackMP4 :: "+curPlaybackMP4+" retryCount[t.playerName] :: "+retryCount[t.playerName]);retryAfterAd=false;console.log('dev21 case mp4 before retryCount[t.playerName] :: '+retryCount[t.playerName]);t.source.url=t.source.urlList[2*curPlaybackMP4-2];console.log('dev21 after url update t.source.url :: ',t.source.url+" for curPlaybackMP4::"+curPlaybackMP4);curPlaybackMP4++;t.loadMp4();console.log('dev21 case mp4 after retryCount[t.playerName] :: '+retryCount[t.playerName]);}else{console.log("dev22 :: case MP4 else curPlaybackMP4 :: "+curPlaybackMP4+" retryCount[t.playerName] :: "+retryCount[t.playerName]);console.log('dev11 else retryCount[t.playerName] was ::'+retryCount[t.playerName]+" Try next player now");retryNextPlayer(curPlayerName);}break;default:retryNextPlayer(curPlayerName);break;}}
function retryNextPlayer(curPlayerName){console.log('in retryNextPlayer1 before  dev21 t.sourceList :: ',t.sourceList);console.log('in retryNextPlayer before  dev21 t.source :: ',t.source);if(isAvailaibleNext(curPlayerName)){playerIndex++;if(playerIndex<t.sourceList.length){console.log('dev21 retryNextPlayer called if with playerIndex::'+playerIndex+" t.sourceList.length"+t.sourceList.length);var loadPlayerFunction=t.functionList[playerIndex];t.source=t.sourceList[playerIndex];console.log('dev12 ========================');console.log('dev12 t.sourceList :: ',t.sourceList);console.log('dev12 t.functionList :: ',t.functionList);console.log('================= dev12');console.log("dev16 t.source.url :: "+t.source.url);loadPlayerFunction();}else{console.log('dev21 retryNextPlayer called else with playerIndex::'+playerIndex+" t.sourceList.length"+t.sourceList.length);showError();}}else{showError();}function showError(){console.log('dev12 ========= showError  ERROR ===============');t.handleError.handleErrorIfAny(MESSAGE.VIDEO_NOT_PLAYING,true,false);}}t.retryPlayer=function(){}
var networkHandler=null;t.offlineHandling=function(){if(networkHandler!=null){clearTimeout(networkHandler);networkHandler=null;}if(SPL.checkIsOnline()){console.log("into offlineHandling online...");t.handleError.handleErrorIfAny(null,true,false);t.reinitConf();}else{console.log("into offlineHandling but playing...");console.log("player setting ",videoElem,currentPlayerObj)
!currentPlayerObj.curPlayer.errorScreen&&t.handleError.handleErrorIfAny(MESSAGE.NETWORK_ERROR,true,true,t.reinitConf);}}
t.eventTimeout=null;t.eventInterval=null;t.eventPatch=function(){var curPlayer=currentPlayerObj.curPlayer;t.eventInterval=setInterval(function(){clearTimeout(t.eventTimeout);if((curPlayer!=undefined)&&(curPlayer.videoElem!=undefined)&&(curPlayer.videoElem.duration==curPlayer.videoElem.position)){console.log("eventPatch :: Time Same Wait for 500ms");t.eventTimeout=setTimeout(sendEvent,500);}else{clearTimeout(t.eventTimeout);}},1000);function sendEvent(){console.log("eventPatch sendEvent called");if(currentPlayerObj.receivedEvents.complete==false){curPlayer.dispatch("complete",true);}clearInterval(t.eventInterval);clearTimeout(t.eventTimeout);}}}