SPL.controller={};SPL.controller.base=function(){var t=this;var currentPlayerObj=this;t.activeElement="";t.isAutoPlay=false;t.allowedPreviewCheck=true;t.previewThreshhold=15;var allowedEvent=["init","ready","_adstate","error","ended","start","state","ended"];t.convertEvent={ready:"onReady",start:"onPlayStart",state:"onStateChange",_adstate:"onAdEvent",fs:"onFullScreen",onDimClick:"onDimClick",onEndScreenAutoPlay:"onEndScreenAutoPlay",onEndScreenReplay:"onEndScreenReplay",onEndScreenPlay:"onEndScreenPlay"}
t.receivedEvents={manifest:false,complete:false,ended:false}
t.setActiveElement=function(activeElement){t.activeElement=activeElement;console.log('activeElement Now is ',activeElement);}
t.getActiveElement=function(){return t.activeElement;}
t.initUI=function(currentPlayerObj){this.loadUI(currentPlayerObj);}
t.init=function(videoData){currentPlayerObj.playerIndex=SPL.allPlayerList.length;SPL.allPlayerList.push(currentPlayerObj);this.load(videoData,currentPlayerObj);if(typeof t.playerObjConfig.playerVars.sp!='undefined'||t.playerObjConfig.playerVars.sp==""){if(SPL.UA.isMobile())t.playerObjConfig.playerVars.sp="mweb";else t.playerObjConfig.playerVars.sp="web";}}
t.loadUI=function(currentPlayerObj){var containerID=currentPlayerObj.containerID;currentPlayerObj.eventManagerObj=new SPL.eventmanager.EventManager(currentPlayerObj);currentPlayerObj.eventManagerObj.on('controller',currentPlayerObj.onPlayerEvent);currentPlayerObj.videoElem="";currentPlayerObj.videoID=containerID+"_videoTag";currentPlayerObj.playerContainerID=containerID;var cc=currentPlayerObj.currentCounter;var isWatermark=currentPlayerObj.playerObjConfig.playerVars.isWatermark;t.isReplay=currentPlayerObj.playerObjConfig.playerVars.isReplay;t.nextplay=currentPlayerObj.playerObjConfig.playerVars.nextplay;console.log("is Replay was :: "+t.isReplay);var watermarkIcon="";var watermarkUrl="";if(isWatermark){watermarkIcon=currentPlayerObj.playerObjConfig.playerVars.watermarkIcon;watermarkUrl=currentPlayerObj.playerObjConfig.playerVars.watermarkUrl;}UTIL.createVideoView(containerID,cc,isWatermark,watermarkIcon,watermarkUrl);currentPlayerObj.playerObjConfig.playerVars.nextplay=true;currentPlayerObj.videoElem=UTIL.createVideoTag(containerID,currentPlayerObj.videoID,cc);_elemAddClass(currentPlayerObj.videoElem,"spl_Fc");}
t.load=function(videoData,currentPlayerObj){currentPlayerObj.Player={};currentPlayerObj.Player=new SPL.SPlayer(currentPlayerObj,videoData,currentPlayerObj.videoElem);currentPlayerObj.Player.init();}
t.onPlayerEvent=function(eventName,eventData,et,userTrigger){if(eventName=='_adstate'){switch(eventData.state){case'load':console.log('================  ADEVENT occur========= with state ',eventData.state);break;case'ready':console.log('================  ADEVENT occur========= with state ',eventData.state);break;case'request':console.log('================  ADEVENT occur========= with state ',eventData.state);break;case'loaded':console.log('================  ADEVENT occur========= with state ',eventData.state);break;case'start':console.log('================  ADEVENT occur========= with state ',eventData.state);t.setActiveElement(t.adManagerObj);break;case'Q1':console.log('================  ADEVENT occur========= with state ',eventData.state);break;case'Q2':console.log('================  ADEVENT occur========= with state ',eventData.state);break;case'Q3':console.log('================  ADEVENT occur========= with state ',eventData.state);break;case'complete':console.log('================  ADEVENT occur========= with state ',eventData.state);break;case'skip':console.log('================  ADEVENT occur========= with state ',eventData.state);break;case'ended':console.log('================  ADEVENT occur========= with state ',eventData.state);t.setActiveElement(t.curPlayer);break;case'error':console.log('================  ADEVENT occur========= with state ',eventData.state);t.setActiveElement(t.curPlayer);break;default:console.log('================  ADEVENT occur========= with state ',eventData.state);}}else{switch(eventName){case"init":t.getFeed();break;case"complete":console.log("complete Event received");t.deletePreview();break;case"ended":if(t.playerObjConfig.playerVars.controls.showEndseekbar!=true){console.log("remove key events after video ends");}else{console.log("Do not remove key events after video ends :: "+t.playerObjConfig.playerVars.controls.showEndseekbar);}document.removeEventListener('keyup',t.keyupListener);break;case"position":break;case"switch":break;}}if(allowedEvent.indexOf(eventName)!=-1){t.sendToClient(eventName,eventData,et);}else{}var argCopy=Array.prototype.slice.call(arguments);argCopy.push(t.playerIndex);if(playerIndex=="undefined"||playerIndex==undefined){playerIndex="";}if(eventName=="_adstate"){console.log("BSPLEVENT_A"+playerIndex+" :: "+eventName+" :: "+eventData.state);}else{if(eventName!="position"){if(eventName=="volume"){console.log("BSPLEVENT_P"+playerIndex+" :: "+eventName+" :: "+eventData.volume+eventData.mute+" "+getCurTime());}else{console.log("BSPLEVENT_P"+playerIndex+" :: "+eventName+" :: ",eventData+" USER::"+userTrigger+" "+getCurTime());}}}(function(argCopy){setTimeout(function(argCopy){try{t.playerObjConfig.onplayerEvent&&t.playerObjConfig.onplayerEvent.apply("",argCopy);}catch(err){console.log("CATCH onplayerEvent"+err.message,t.playerObjConfig);}},0,argCopy);})(argCopy);switch(eventName){case"init":console.log('init');break;case"ready":console.log('ready');t.createKeyboardEvents();break;case"initload":console.log('dev08 initload');t.playerInitCallback();break;case"_adstate":break;case"manifest":console.log('manifest');break;case"volume":SPL.setLocalSettings({volume:eventData.volume});console.log('volume :: '+eventData.volume);break;case"position":if(t.EndScreenPreview_Obj!=null&&t.EndScreenPreview_Obj!=undefined&&t.isPreViewVisible==true){var cP=eventData.position;var cD=eventData.duration;var tH=t.previewThreshhold;t.EndScreenPreview_Obj.setWidth(cP,cD,tH);}if(t.allowedPreviewCheck&&!SPL.isMobile){t.allowedPreviewCheck=false;t.checkPreview(eventData);setTimeout(function(){t.allowedPreviewCheck=true;},1000);}break;case"state":break;case"start":console.log('PL :: start event received');var isPlaylist=t.playerObjConfig.playerVars.playlist;if(isPlaylist=="true"||isPlaylist==true){var nextVideoID=t.getNextVideoId(t.videoId);console.log("PL nextvideoid :: ",nextVideoID,t.videoId);if(nextVideoID!=""&&nextVideoID!=undefined&&nextVideoID!="undefined"&&nextVideoID!=null){console.log("Set next ");t.setNextVideo(nextVideoID);}else{console.log("Do not set next ");t.playerObjConfig.playerVars.nextVideoID="";}console.log("PL getPrevVideoId will call");var prevVideoID=t.getPrevVideoId(t.videoId);console.log("PL prevVideoID :: ",prevVideoID+" for CurVideo :: "+t.videoId);if(prevVideoID!=""&&prevVideoID!=undefined&&prevVideoID!="undefined"&&prevVideoID!=null){console.log("Set prev ");t.setPrevVideo(prevVideoID);}else{console.log("Do not set prev ");t.playerObjConfig.playerVars.prevVideoID="";}}else{var nextVideoID=t.playerObjConfig.playerVars.nextVideoID;if(nextVideoID!=""&&nextVideoID!=undefined&&nextVideoID!="undefined"&&nextVideoID!=null){console.log("Set next ");t.setNextVideo(nextVideoID);}else{t.playerObjConfig.playerVars.controls.autoplayDefault=false;t.controlsBaseObj.isAutoPlayNext=false;console.log("Do not set next ");}}break;case"switch":break;case"error":console.log('error occur');break;default:console.log('default :: eventName :: '+eventName);break;}};t.sendToClient=function(eventName,eventData,eventType){console.log("Allowed to send to client becasue eventName :: "+eventName);var e=eventName;var playerData=t.curPlayer.getData();var data=[];data[0]=eventData;data[1]=playerData;console.log("before eventName2 :: "+eventName);var eventNameNew=t.convertEvent[eventName];if(eventNameNew!=undefined){eventName=eventNameNew}console.log("after eventName2:: "+eventName);switch(eventName){case"onReady":console.log("onReady Params:: ",e,data);currentPlayerObj.playerObjConfig.events.onReady(e,data);break;case"onPlayStart":currentPlayerObj.playerObjConfig.events.onPlayStart(e,data,t);break;case"start":currentPlayerObj.playerObjConfig.events.onPlayStart(e,data,t);t.overlayContainer();var isOverlayAds=currentPlayerObj.playerObjConfig.playerVars.isOverlayAds;console.log("overlay 0.5 ::"+isOverlayAds);if(isOverlayAds==true||isOverlayAds=="true"){console.log("overlay 1");var overlayContainer=t.overlayContainer;var showOverlayAds=t.showOverlayAds;var hideOverlayAds=t.hideOverlayAds;console.log("overlay 1.5 showCB :: ",showOverlayAds);currentPlayerObj.playerObjConfig.events.onOverlayAds(showOverlayAds,hideOverlayAds,overlayContainer);}break;case"ended":console.log("currentPlayerObj.playerObjConfig.events.onEnd");currentPlayerObj.playerObjConfig.events.onEnd(e,data,t);break;case"complete":console.log("complete Event Received");break;case"onStateChange":console.log("client :: onStateChange ",e,data);var curPlayer=t.curPlayer;currentPlayerObj.playerObjConfig.events.onStateChange(e,data);break;case"onAdEvent":console.log("client onAdEvent ");t.deletePreview();currentPlayerObj.playerObjConfig.events.onAdEvent(e,data);break;case"onFullScreen":console.log("client onFullScreen ");currentPlayerObj.playerObjConfig.events.onFullScreen(e,data);break;case"onDimClick":console.log("client onDimClick ");currentPlayerObj.playerObjConfig.events.onDimClick(e,data);break;case"onEndScreenAutoPlay":console.log("client onEndScreenAutoPlay ");currentPlayerObj.playerObjConfig.events.onEndScreenAutoPlay(e,data);break;case"onEndScreenReplay":console.log("client onEndScreenReplay ");currentPlayerObj.playerObjConfig.events.onEndScreenReplay(e,data);break;case"onEndScreenPlay":console.log("client onEndScreenPlay ");currentPlayerObj.playerObjConfig.events.onEndScreenPlay(e,data);break;case"onEndScreenNextClick":console.log("client onEndScreenNextClick ");currentPlayerObj.playerObjConfig.events.onEndScreenNextClick(e,data);break;case"onEndScreenAutoPlay":console.log("client onEndScreenAutoPlay ");currentPlayerObj.playerObjConfig.events.onEndScreenAutoPlay(e,data);break;default:break;}}
t.playerInitCallback=function(){console.log("dev08 Sending playerInitCallback to client ");if(t.onLoad&&typeof t.onLoad=="function"){console.log("dev08 Sending playerInitCallback to client onload");t.onLoad(t);}else{console.log("dev08 Sending playerInitCallback to client fail");}}
t.destroy=function(mainCbfn){currentPlayerObj.Player.destroy(destroyCb_Player);currentPlayerObj.eventManagerObj.unsubscribe('controller');function destroyCb_Player(){currentPlayerObj.Player=null;currentPlayerObj.eventManagerObj.destroy(destroyCb_Event);}function destroyCb_Event(){currentPlayerObj.eventManagerObj=null;document.removeEventListener('keyup',t.keyupListener);mainCbfn();}}
t.keyupListener=function(event){if(t.controlsBaseObj&&t.controlsBaseObj.cbar){var cbar=t.controlsBaseObj.cbar;console.log("cbar is ",cbar);cbar.show();}if(t.controlsBaseObj&&t.controlsBaseObj.hideQualityMenu){t.controlsBaseObj.hideQualityMenu();}var keyCode=event.keyCode;console.log('keyCode ::'+keyCode+" playerIndex :: "+t.playerIndex);switch(keyCode){case key.space:console.log('space');t.togglePlay();break;case key.left:console.log('left');t.seek(-5);break;case key.right:console.log('right');t.seek(5);break;case key.up:case key.volumeUp:console.log('up');t.volume(2);break;case key.down:case key.volumeDown:console.log('down');t.volume(-2);break;default:t.test(keyCode);console.log('test');break;}}
t.createKeyboardEvents=function(){console.log('createKeyboardEvents called');var playerOuter=_el(t.playerObjConfig.containerID);document.addEventListener('keyup',t.keyupListener);document.addEventListener('keydown',function(e){console.log("Event Listner called",e);});}
t.togglePlay=function(){if(currentPlayerObj.getActiveElement==undefined)return;console.log('togglePlay ',currentPlayerObj.getActiveElement());var isPaused=currentPlayerObj.getActiveElement().isPaused;if(isPaused){currentPlayerObj.getActiveElement().play();}else{currentPlayerObj.getActiveElement().pause();}}
t.seek=function(amount){console.log('seek');currentPlayerObj.Player.seek(amount);}
t.play=function(){console.log('play called from Base');debugger;currentPlayerObj.Player.play();}
t.pause=function(){debugger;console.log('pause called from Base');currentPlayerObj.Player.pause();}
t.setVolume=function(amount){if(amount>100){amount=100;}if(amount<1){amount=0;}var volume=t.controlsBaseObj.volume;volume.show();console.log('setVolume :: '+amount);currentPlayerObj.Player.setVolume(amount);}
t.volume=function(amount){console.log('volume '+amount);var curVolume=t.getVolume();t.setVolume(curVolume+amount)}
t.getVolume=function(){var curVolume=currentPlayerObj.Player.getVolume();console.log('getVolume :: '+curVolume);return curVolume;}
t.hibernate=function(cb){console.log('baseController hibernate');function sPlayerCB(status){if(typeof cb=="function"){var status=status||"SUCCESS";console.log('callback to callee with status :: '+status);cb(status);}}if(typeof currentPlayerObj.Player.hibernate=="function"){currentPlayerObj.Player.hibernate(sPlayerCB);}}
t.test=function(keycode){switch(keycode){case 82:console.log('======= R KEY =========');t.Player.test();break;default:break;}}
t.isPreViewVisible=false;t.EndScreenPreview_Obj=null;t.createNextHover=function(){if(SPL.isMobile){return;}if(t.playerObjConfig.playerVars.nextButton==false){return;}var nextVideoID=t.playerObjConfig.playerVars.nextVideoID;t.EndScreenPreview_Left=new EndScreenPreview(nextVideoID,t,t.NextVideoData);var leftContainer=t.EndScreenPreview_Left.init("left");t.controlsBaseObj&&(t.controlsBaseObj.nextScreenleft=leftContainer);}
t.createPrevHover=function(){if(SPL.isMobile){return;}var prevVideoID=t.prevVideoID;t.EndScreenPreview_Left=new EndScreenPreview(prevVideoID,t,t.PrevVideoData);var leftContainer=t.EndScreenPreview_Left.init("leftPrev");t.controlsBaseObj&&(t.controlsBaseObj.prevScreenleft=leftContainer);}
t.deletePreview=function(){if(t.EndScreenPreview_Obj!=null&&t.EndScreenPreview_Obj!=undefined){t.isPreViewVisible=false;t.EndScreenPreview_Obj.delete("right");t.EndScreenPreview_Obj=null;t.controlsBaseObj&&(t.controlsBaseObj.endScreenVisible=false);}}
t.checkPreview=function(eventData){var autoPlayFlag=t.controlsBaseObj.isAutoPlayNext;if(!autoPlayFlag){return;}else{}var curPosition=eventData.position;var curDuration=eventData.duration;var diff=curDuration-curPosition;var diffThreshhold=t.previewThreshhold;if(diff<diffThreshhold){if(t.isPreViewVisible==false){t.isPreViewVisible=true;t.EndScreenPreview_Obj=new EndScreenPreview("hls",t,t.NextVideoData);t.EndScreenPreview_Obj.init("right");t.controlsBaseObj&&(t.controlsBaseObj.endScreenVisible=true);}else{}}else if(diff>diffThreshhold){if(t.isPreViewVisible){if(t.EndScreenPreview_Obj!=null&&t.EndScreenPreview_Obj!=undefined){t.isPreViewVisible=false;t.EndScreenPreview_Obj.delete("right");t.EndScreenPreview_Obj=null;t.controlsBaseObj&&(t.controlsBaseObj.endScreenVisible=false);}}else{}}};t.setNextVideo=function(nextVideoID){console.log("setNextVideo :: "+nextVideoID);currentPlayerObj.playerObjConfig.playerVars.nextVideoID=nextVideoID;function SuccessCB(videoData){console.log("setNextVideo7 got next video Data",videoData);t.NextVideoData=videoData;t.createNextHover();t.controlsBaseObj&&t.controlsBaseObj.showNextButton&&t.controlsBaseObj.showNextButton();}function FailureCB(STATUS){console.log(" setNextVideo9 Unable to get next Video Data");}t.getNextData(nextVideoID,SuccessCB,FailureCB);};t.setPrevVideo=function(prevVideoID){console.log("setPrevVideo :: "+prevVideoID);currentPlayerObj.playerObjConfig.playerVars.prevVideoID=prevVideoID;function SuccessCB(videoData){console.log("setPrevVideo7 got prev video Data",videoData);t.PrevVideoData=videoData;t.createPrevHover();t.controlsBaseObj&&t.controlsBaseObj.showPrevButton&&t.controlsBaseObj.showPrevButton();}function FailureCB(STATUS){console.log(" setPrevVideo9 Unable to get prev Video Data");}t.getPrevData(prevVideoID,SuccessCB,FailureCB);};t.getPrevData=function(prevVideoID,callbackS,callbackF){console.log("setPrevVideo6 ");SPL.Api.feed(prevVideoID,function(videoData){if(videoData===undefined){console.log("setPrevVideo9 VideoData was undefined");var STATUS="FAILURE0";callbackF&&callbackF(STATUS);}else if(videoData.error!==undefined){if(videoData.error=="404"){console.log("setPrevVideo10");var STATUS="FAILURE1";callbackF&&callbackF(STATUS);}else{console.log("setPrevVideo11 VideoData was error");var STATUS="FAILURE2";callbackF&&callbackF(STATUS);}}else if(videoData=="FAILURE"){console.log("setPrevVideo12 Error :: "+videoData);var STATUS="FAILURE3";callbackF&&callbackF(STATUS);}else{callbackS&&callbackS(videoData);}});};t.getFeed=function(){console.log("feed3");t.feedData=t.playerObjConfig.feedData;if(t.feedData!=undefined&&t.feedData!=null&&t.feedData!=""){return;}console.log("playerContainerID",t.playerObjConfig);var isPlaylist=t.playerObjConfig.playerVars.playlist;console.log("feed 4 :: "+isPlaylist);var playlistUrl=t.playerObjConfig.playerVars.nextVideoUrl;var playlistUrl="/videpostroll_v5/61358347.cms?feedtype=json&dontshow=61358347&callback=cached";console.log("feed 5 :: "+playlistUrl);loadJs(playlistUrl,function(){console.log("feed Recieved");})};window.cached=function(feedData){console.log("feedData :: "+feedData);S.feedData=feedData;S.playerObjConfig.feedData=feedData;S.isFeedAvailaible=true;t.feedData=feedData;t.playerObjConfig.feedData=feedData;t.isFeedAvailaible=true;var nextVideoID=t.getNextVideoId(t.videoId);console.log("PL nextvideoid :: ",nextVideoID,t.videoId);if(nextVideoID!=""&&nextVideoID!=undefined&&nextVideoID!="undefined"&&nextVideoID!=null){console.log("Set next ");t.setNextVideo(nextVideoID);}else{console.log("Do not set next ");t.playerObjConfig.playerVars.nextVideoID="";}};t.getNextData=function(nextVideoID,callbackS,callbackF){console.log("setNextVideo6 ");SPL.Api.feed(nextVideoID,function(videoData){if(videoData===undefined){console.log("setNextVideo9 VideoData was undefined");var STATUS="FAILURE0";callbackF&&callbackF(STATUS);}else if(videoData.error!==undefined){if(videoData.error=="404"){console.log("setNextVideo10");var STATUS="FAILURE1";callbackF&&callbackF(STATUS);}else{console.log("setNextVideo11 VideoData was error");var STATUS="FAILURE2";callbackF&&callbackF(STATUS);}}else if(videoData=="FAILURE"){console.log("setNextVideo12 Error :: "+videoData);var STATUS="FAILURE3";callbackF&&callbackF(STATUS);}else{callbackS&&callbackS(videoData);}});};t.getNextVideoId=function(curVideoId){console.log("PL curVideoId :: ",curVideoId);if(t.feedData==undefined||t.feedData==""||t.feedData==null){return"";}var videoData=t.feedData;var cycle=false;var videoLength=videoData.length;var listlength=0;var nextVideoID="";console.log("PL :: ",t.feedData);if(cycle==true){listlength=videoData.length;}else{listlength=videoData.length-1;}for(var i=0;i<listlength;i++){if(videoData[i]._id==curVideoId){var next=(i+1)%videoLength;nextVideoID=videoData[next].kalturaid;}}console.log("PL :: curVideoId :: ",curVideoId);console.log("PL :: nextVideoID :: "+nextVideoID);return nextVideoID;}
t.getPrevVideoId=function(curVideoId){if(t.feedData==undefined||t.feedData==""||t.feedData==null){return"";}var videoData=t.feedData;var cycle=false;var videoLength=videoData.length;var listlength=0;var prevVideoID="";console.log("PL :: ",t.feedData);listlength=videoData.length;console.log("PL :: length :: "+listlength);for(var i=0;i<listlength;i++){if(videoData[i]._id==curVideoId){var prev=(i-1);if(prev<0)break;console.log("Prev was  :: "+prev);prevVideoID=videoData[prev]._id;}}console.log("PLprev :: curVideoId :: ",curVideoId);console.log("PLprev :: prevVideoID :: "+prevVideoID);return prevVideoID;}
t.showOverlayAds=function(){console.log("overlay 4");_elemRemoveClass(t.overlayContainer,"spl_H");}
t.hideOverlayAds=function(){console.log("hideOverlayAds called");_elemAddClass(t.overlayContainer,"spl_H");}
t.overlayContainer=function(){var overLayParent=t.controlsBaseObj.actiondiv;console.log("overlay 0 ::",overLayParent);var overlayContainer=UTIL.createDiv("overlayContainer1","spl_banner spl_A spl_Fb spl_aBR",overLayParent);t.overlayContainer=overlayContainer;}}